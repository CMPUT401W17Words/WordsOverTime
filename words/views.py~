from django.shortcuts import render, get_object_or_404
from django.http import HttpResponse
from django.views import generic
import random
from datetime import datetime, date, time, timedelta
import time

from .forms import MainForm
from .requesthandler import *

GRANULARITY_WEEKLY = 1
GRANULARITY_MONTHLY = 2
GRANULARITY_YEARLY = 3


# Create your views here.
def index(request):
    return render(request, 'words/index.html')
    #return HttpResponse("Hello world")

def graph(request):
    #testList = [0.1,0.1,0.1,0.1]
    #testDict = {}
    #testDict["hello"] = testList
    #testList2 = [1, 2, 3, 4]
    #testDict2 = {}
    #testDict2["foobar"] = testList2
    keyWords = []
    startDate = date.today()
    endDate = date.today()
    granularity = GRANULARITY_YEARLY
    n = 0
    form = MainForm(request.POST)
    #if form.is_valid():
        #keyWords = form.cleaned_data['keywords']
        #print (keyWords)
        #keyWordsList = keyWords.split()
        
        
        #print (keyWordsList)
        
        #startDate = form.cleaned_data['startDate']
        #endDate = form.cleaned_data['endDate']
        #granularity = form.cleaned_data['granularity']
        
        #n = form.cleaned_data['nNeighbour']


    #Get Form Data!
    startDateString = request.POST["startDate"]
    endDateString = request.POST["endDate"]
    startDate = datetime.strptime(startDateString, '%Y-%m-%d')
    endDate = datetime.strptime(endDateString, '%Y-%m-%d')
    granularity = int(request.POST["granularity"])
    
    #Form data for n closest neighbors
    n = int(request.POST["Nneighbor"])
    keyWords = request.POST["keywords"]
    keyWordsList = keyWords.split()    
    #textFile = request.FILES["text_file"]
    skipOrCBOW1 = request.POST["skipOrCBOW1"]
    #TODO: read in file and create list of strings from it
    #How to separate words?

    #Form data for cosine distance
    wordPair = request.POST["wordPairs"]
    #textFile2 = request.FILES["text_file2"]
    skipOrCBOW2 = request.POST["skipOrCBOW2"]
    #TODO: read in file and create list of strings from it
    #How to separate words?
    
    #Form data for tfidf
    tfidfWord = request.POST["tfidfWord"]
    
    #Form data for Pairwise Conditional Probabilities
    conditionalWordPair = request.POST["conditionalWord"]
    #fileConditional = request.FILES["fileConditional"]
    #TODO: read in file and create list of strings from it
    #How to separate words?

    #Form data from checkboxes
    averageValence = request.POST["Average valence"]
    averageArousal = request.POST["Average arousal"]
    top5averageValence = request.POST["5 Words Average valence"]
    top5averageArousal = request.POST["5 Words Average arousal"]

    #Form data for word frequency
    wordFrequencyWords = request.POST["frequencyWord"]
    #wordFrequencyFile = request.FILES["wordFrequencyFile"]
    #TODO: read in file and create list of strings from it
    #How to separate words?

    #Form data for relative word frequency
    relativeWords = request.POST["relativeWord"]
    #relativeFile = request.FILES["relativeFile"]
    #TODO: read in file and create list of strings from it
    #How to separate words?

    #Form data for email
    email = request.POST["userEmail"]
    

    #print (keyWords)
    #keyWordsList = ['rabbit', 'bird']
    #req = CosDistanceOverTimeRequest((startDate, endDate), 'Year', keyWordsList[0], keyWordsList[1])
    #result = req.execute()
    print(granularity)
    print (n)

    xValues = [];
    #weekly
    if(granularity == GRANULARITY_WEEKLY):
        timeDiff = timedelta(days = 7)
    #monthly
    elif (granularity == GRANULARITY_MONTHLY):
        #TODO: change it to be correct number of days for each month?
        timeDiff = timedelta(days = 30)
    #yearly
    else:
        timeDiff = timedelta(days = 365) 
    
    tempDate = startDate
    timestamp = 0
    while(tempDate < endDate):
        timestamp = int(time.mktime(tempDate.timetuple())) * 1000
        xValues.append(timestamp)
        tempDate = tempDate + timeDiff

    #years = result.xValues
    #years = []
    #yearDiff = endDate.year - startDate.year
    #for i in range (0, yearDiff):
    #    years.append(startDate.year + i)

    #yValues = result.yValues
    yValues = []
    for i in range(0, len(xValues)):
        randomNum = random.randint(1,4)
        yValues.append(randomNum)

    #splitKeywords = keyWords.split()

    #yValuesList = []
    #for j in range (0, len(keyWords)):
    #    yValuesList.append([])
    #    for i in range (0, len(years)):
    #        randomNum = random.randint(1,4)
    #        yValuesList[j].append(randomNum)

    #xAxis = result.xTitle
    #yAxis = result.yTitle
    xAxis = "Date"
    yAxis = "Valence"
    word1 = "Hello"
    word2 = "Hi"
    #w1x = [1,6,3,4]
    #w1y = [1,3,6,7]
    #w2x = [2,5,6,7]
    #w2y = [1,4,7,9]
    context = {
        'xAxis': xAxis,
        'yAxis': yAxis,
        #'word1': word1,
        #'word2': word2, 
        'xValues': xValues,
        #'w1x': w1x,
        #'w1y': w1y,
        #'w2x': w2x,
        #'w2y': w2y,
        'keywords': keyWords,
        'yValues': yValues
    }
    return render(request, 'words/graph2.html', context)
 
#class IndexView(generic.DetailView):
  #template_name = "words/index.html"
  
def results(request):
  if request.method == 'POST':
    form = ContactForm(request.POST) 
    if form.is_valid():
      data = myform.cleaned_data
      #process data with field = data['field']
      #generate a Request object (see requesthandler.py)
  return HttpResponseRedirect()
